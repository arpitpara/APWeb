<!DOCTYPE HTML>
<html manifest="manifest.appcache">
  <head>
    <title>ArduPilot</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/styles.css">
    <script type="text/javascript" src="/js/config.js"></script>
    <script type="text/javascript" src="/js/cors.js"></script>
    <script type="text/javascript" src="/js/mavlink.js"></script>
  </head>
<body>

<p><a href="/index.html"><img src="/images/main_logo.png" alt="ArduPilot"></a></p>

<h1>Video Streaming</h1>

<p><input type="submit" name="action" value="Refresh Camera List" onclick="refresh();"></p>

<table id="rtsp_table" class="parameters">
  <tr><th>Camera Name</th><th class="alnright">RTSP Mount Point</th><th>Camera Type</th></tr>
</table>
<script>
    // 0 - name
    // 1 - mtpt
    // 2 - camtype
    function fill_rtsp_table(cam_data) {
        console.log(cam_data);
        var table = document.getElementById("rtsp_table");

        // delete any existing rows
        var nrows = table.rows.length;
        for (var i=nrows-1; i>0; i--) {
            table.deleteRow(i);
        }

        if (cam_data == "ERROR\n") {
            console.log("error str");
            alert("Cannot connect to the local RTSP Stream server");    
        } else {
            var plist;
            try {
                plist = JSON.parse(cam_data);
                plist.sort(function(a,b) {
                    if (a.mount < b.mount) {
                        return -1;
                    }
                    if (a.mount > b.mount) {
                        return 1;
                    }
                    return 0;
                });
            } catch(e) {
                console.log(e);
                return;
            }

            var n = plist.length;
            for (var i=0; i<n; i++) {
                var row = table.insertRow(table.rows.length);
                var rowdata = plist[i];
                row.insertCell(0).innerHTML = rowdata.name;
                var mount_url = "rtsp://10.0.1.128:8554" + rowdata.mount;
                row.insertCell(1).innerHTML = mount_url;
                var cameratype;
                if (rowdata.camtype == "0") {
                    cameratype = "video/x-raw";
                } else if (rowdata.camtype == "1") {
                    cameratype = "video/x-h264";
                }
                console.log(rowdata.camtype);
                row.insertCell(2).innerHTML = cameratype;
            }
        }
    }

    function refresh() {
        command_send("get_camera_details()", { "onload" : fill_rtsp_table });
    }

</script>
</html>